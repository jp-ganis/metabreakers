<!DOCTYPE html>
<html lang="en">

<head>
	<link href="https://fonts.googleapis.com/css?family=Abel&display=swap" rel="stylesheet">
	<link href="https://fonts.googleapis.com/css?family=Abel&display=swap" rel="stylesheet">
	<link rel="stylesheet" href="style.css">

    <title>Metabreakers.to</title>
</head>

<body bgcolor='#35342F' text='#FEF7DB'>
	<font color="#33F7DB"></font>
    <div><a type='title' href="index.html" ><font size="6" >Metabreakers.to</font></a></div>
    <div><a type='title' href="index.html" id="playerNameTitle"><font size="5" >Player Page</font></a></div>
	
    <br />
	<font size="4" >Rankings Score:</font> <font color='#33F7DB'><div id="rankings_score" style="display:inline"></div></font>
    <br />
	<!-- <font size="4" >Meta-Adjusted Rankings Score:</font> <font color='#33F7DB'><div id="mar_score" style="display:inline"></div></font> -->
    <!-- <br /> -->
    <br />
	<font size="4" >Most Played Faction:</font> <font color='#33F7DB'><div id="most_played_faction" style="display:inline"></div></font>
    <br />
	<font size="4" >Best Scoring Faction:</font> <font color='#33F7DB'><div id="best_scoring_faction" style="display:inline"></div></font>
    <br />
	<br />
	<font size="4" >Metabreakers Score:</font> <font color='#33F7DB'><div id="mbrs_score" style="display:inline"></div></font>
    <br />
	<font size="4" >Best Metabreakers Faction:</font> <font color='#33F7DB'><div id="best_mbrs_faction" style="display:inline"></div></font>
    <br />
    <br />
	
	<table class='weapon1' type='playerPageTable'>
		<tr>
			<td colspan="10">
				<center><font size="5">Event Scores</font></center>
			</td>
		</tr>
		<tr id='headingRow'>
			<td type='eventName' width='200px'>
				<center><font size="5">Event Name</font></center>
			</td>
			<td type='eventDate' width='200px'>
				<center><font size="5">Event Date</font></center>
			</td>
			<td type='armyName' width='200px'>
				<center><font size="5">Faction</font></center>
			</td>
			<td type='placing' width='200px'>
				<center><font size="5">Placing</font></center>
			</td>
			<td type='score' width='200px'>
				<center><font size="5">Rankings Score</font></center> 
			</td>
			<td type='metabreakerScore' width='200px'>
				<center><font size="5">Metabreaker Score</font></center> 
			</td>
		</tr>
		<tr id='eventRow0'>
			<td type='eventName'>
				%EVENT_NAME%
			</td>
			<td type='eventDate'>
				%EVENT_DATE%
			</td>
			<td type='armyName'>
				%ARMY_CHOICE%
			</td>
			<td type='placing'>
				%PLACING% out of %NUM_PLAYERS%
			</td>
			<td type='score'>
				%EVENT_SCORE%
			</td>
			<td type='metabreakerScore'>
				%METABREAKERS_SCORE%
			</td>
		</tr>
	</table>
	<br/>
	<br/>
	<br/>
	<table id="achievement_table">		
		<tr>
			<td colspan="10">
				<center><font size="5">Achievements</font></center>
			</td>
		</tr>
		
		<!-- <tr> -->
			<!-- <td> -->
				<!-- <div class="container"> -->
					<!-- <img src="achievements/never_meet_your_heroes.png"> -->
					<!-- <div class="centered">FOTOW VI- March 2019</div> -->
				<!-- </div> -->
			<!-- </td> -->
		<!-- </tr> -->
		<!-- <tr> -->
			<!-- <td> -->
				<!-- <div class="container"> -->
					<!-- <img src="achievements/never_meet_your_heroes_incomplete.png"> -->
				<!-- </div> -->
			<!-- </td> -->
		<!-- </tr> -->
	</table>
	
	<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
    <script src="d3.v3.min.js"></script>
	<script>
		window.onload = populatePlayerData();
		
		function populatePlayerData()
		{
			let playerId = getPlayerId();
			
			document.getElementById("playerNameTitle").innerHTML = "<font size=\"5\" >"+playerId+"</font>";

			populateAchievementData(playerId);
			
			$.getJSON("data/uk_events/datahub_player_data.json", function(json) {
				let data = json[playerId];
				let firstRow = "True";
				
				populateAchievementData(data);
				
				data["events"].forEach( function(d)
				{ 
					addRow(d, firstRow);
					firstRow = "False";
				});
				
				
				document.getElementById("rankings_score").innerHTML = Math.round(data["gaussian_score"],1) + " (Rank " + data["gaussian_rank"] + ")";
				document.getElementById("most_played_faction").innerHTML = data["most_played_faction"];
				document.getElementById("best_scoring_faction").innerHTML = data["best_scoring_faction"];
				<!-- document.getElementById("mar_score").innerHTML =  Math.round(data["meta_adjusted_rankings_score"]).toFixed(0) + " (Rank " +data["meta_adjusted_rankings_rank"] + ")"; -->
				
				
				let mbrsScore = Math.round(data["metabreakers_score"]*100, 1).toFixed(1);
				let posNegString = "<font color='grey'>";
				if (mbrsScore > 0) posNegString = "<font color='#66FF00'>+";				
				document.getElementById("mbrs_score").innerHTML =  posNegString+mbrsScore+"</font>" + " (Rank " +data["metabreakers_rank"] + ")";
				
				document.getElementById("best_mbrs_faction").innerHTML = data["best_metabreakers_faction"];
			});
		}
		
		function populateAchievementData(playerId)
		{
			var achievement_data = null;
			
			if (location.hostname === "")
			{
				achievement_data = {'actually_i_kinda_like_the_teclis_model': {'id': 'actually_i_kinda_like_the_teclis_model', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'bite_me': {'id': 'bite_me', 'category': 'matchups', 'points': 10, 'event_and_date': 'Fall of The Old World V - March 2019', 'complete': "True"}, 'black_coach_down': {'id': 'black_coach_down', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'blood_of_the_blood_god': {'id': 'blood_of_the_blood_god', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'bringing_the_pain_train_to_the_khaine_dame': {'id': 'bringing_the_pain_train_to_the_khaine_dame', 'category': 'matchups', 'points': 10, 'event_and_date': 'Northern Masters 2019 - July 2019', 'complete': "True"}, 'chew_on_this': {'id': 'chew_on_this', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'count_as_zero_models_when_their_dead_though': {'id': 'count_as_zero_models_when_their_dead_though', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'eels_whyd_it_have_to_be_eels': {'id': 'eels_whyd_it_have_to_be_eels', 'category': 'matchups', 'points': 10, 'event_and_date': 'The Howling 3: Full Moon Fever - October 2019', 'complete': "True"}, 'goat': {'id': 'goat', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'im_gonna_pay_you_100_aethergold': {'id': 'im_gonna_pay_you_100_aethergold', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'jack': {'id': 'jack', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'jawbreakers': {'id': 'jawbreakers', 'category': 'matchups', 'points': 10, 'event_and_date': 'Northern Masters 2019 - July 2019', 'complete': "True"}, 'just_as_planned': {'id': 'just_as_planned', 'category': 'matchups', 'points': 10, 'event_and_date': 'Tempest 2020 - January 2020', 'complete': "True"}, 'life_uh_finds_a_way': {'id': 'life_uh_finds_a_way', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'light_be_with_you': {'id': 'light_be_with_you', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'lightning_doesnt_even_strike_once': {'id': 'lightning_doesnt_even_strike_once', 'category': 'matchups', 'points': 10, 'event_and_date': 'The Howling 3: Full Moon Fever - October 2019', 'complete': "True"}, 'literally_griefing': {'id': 'literally_griefing', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'lots_o_grots': {'id': 'lots_o_grots', 'category': 'matchups', 'points': 10, 'event_and_date': 'Tempest 2020 - January 2020', 'complete': "True"}, 'more_like_arkhant': {'id': 'more_like_arkhant', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'nobody_tosses_a_wait': {'id': 'nobody_tosses_a_wait', 'category': 'matchups', 'points': 10, 'event_and_date': 'Onslaught 2020 - August 2020', 'complete': "True"}, 'ratcatchin': {'id': 'ratcatchin', 'category': 'matchups', 'points': 10, 'event_and_date': 'Tempest 2020 - January 2020', 'complete': "True"}, 'that_was_sick': {'id': 'that_was_sick', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'the_real_fake_mortarch': {'id': 'the_real_fake_mortarch', 'category': 'matchups', 'points': 10, 'event_and_date': 'Onslaught 2020 - August 2020', 'complete': "True"}, 'this_is_my_boomstick': {'id': 'this_is_my_boomstick', 'category': 'matchups', 'points': 10, 'event_and_date': 'Fall of The Old World V - March 2019', 'complete': "True"}, 'tithe_evasion': {'id': 'tithe_evasion', 'category': 'matchups', 'points': 10, 'event_and_date': 'Tempest 2020 - January 2020', 'complete': "True"}, 'wait_were_you_enjoying_that': {'id': 'wait_were_you_enjoying_that', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'we_did_it_rage_kage': {'id': 'we_did_it_rage_kage', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'winners_dont_split_and_splitters_dont_win': {'id': 'winners_dont_split_and_splitters_dont_win', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'wyld_wyld_west': {'id': 'wyld_wyld_west', 'category': 'matchups', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'at_all_costs': {'id': 'at_all_costs', 'category': 'faction_tiers', 'points': 10, 'event_and_date': 'Northern Invasion - August 2018', 'complete': "True"}, 'challenge_mode': {'id': 'challenge_mode', 'category': 'faction_tiers', 'points': 10, 'event_and_date': 'Fall of The Old World VI - March 2020', 'complete': "True"}, 'on_the_board': {'id': 'on_the_board', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'double_up': {'id': 'double_up', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'triple_threat': {'id': 'triple_threat', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'quadratic_equations': {'id': 'double_up', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'iambic_pentameter': {'id': 'iambic_pentameter', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of The Old World V - March 2019', 'complete': "True"}, 'just_play': {'id': 'just_play', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'just_play_2': {'id': 'just_play_2', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'just_play_3': {'id': 'just_play_3', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'just_play_4': {'id': 'just_play_4', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'just_play_5': {'id': 'just_play_5', 'category': 'general', 'points': 30, 'complete': "False", 'event_and_date': ''}, 'ok_but_sometimes_you_just_gotta_let_em_know': {'id': 'i_coulda_been_somebody', 'category': 'general', 'points': 30, 'complete': "False", 'event_and_date': ''}, 'i_coulda_been_somebody': {'id': 'i_coulda_been_somebody', 'category': 'general', 'points': 10, 'event_and_date': 'Fall of the Old World III - March 2017', 'complete': "True"}, 'its_5_and_0_somewhere': {'id': 'its_5_and_0_somewhere', 'category': 'general', 'points': 10, 'event_and_date': 'The Howling 3: Full Moon Fever - October 2019', 'complete': "True"}, 'grudge_bearer': {'id': 'grudge_bearer', 'category': 'general', 'points': 10, 'event_and_date': 'Clash of Swords - August 2015', 'complete': "True"}, 'grudge_bearer_2': {'id': 'grudge_bearer_2', 'category': 'general', 'points': 20, 'event_and_date': 'Clash of Swords - August 2015', 'complete': "True"}, 'grudge_bearer_3': {'id': 'grudge_bearer_3', 'category': 'general', 'points': 50, 'complete': "False", 'event_and_date': ''}, 'this_game_is_entirely_luck': {'id': 'this_game_is_entirely_luck', 'category': 'general', 'points': 10, 'event_and_date': 'Tempest 2020 - January 2020', 'complete': "True"}, 'this_game_is_entirely_skill': {'id': 'this_game_is_entirely_skill', 'category': 'general', 'points': 10, 'event_and_date': 'The Howling 3: Full Moon Fever - October 2019', 'complete': "True"}, 'i_am_sigmars_sixes_to_hit': {'id': 'i_am_sigmars_sixes_to_hit', 'category': 'general', 'points': 10, 'event_and_date': 'The Howling 3: Full Moon Fever - October 2019', 'complete': "True"}, 'i_declare_im_jinking': {'id': 'i_declare_im_jinking', 'category': 'general', 'points': 10, 'event_and_date': 'Tempest 2020 - January 2020', 'complete': "True"}, 'trust_aethermatics_not_superstition': {'id': 'trust_aethermatics_not_superstition', 'category': 'general', 'points': 10, 'event_and_date': 'Tempest 2020 - January 2020', 'complete': "True"}, 'the_activation_wars': {'id': 'the_activation_wars', 'category': 'general', 'points': 10, 'event_and_date': 'The Howling 3: Full Moon Fever - October 2019', 'complete': "True"}, 'rage_against_the_machine': {'id': 'rage_against_the_machine', 'category': 'general', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'lovable': {'id': 'lovable', 'category': 'general', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'two_thin_coats': {'id': 'two_thin_coats', 'category': 'general', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'bench_em': {'id': 'bench_em', 'category': 'scotland', 'points': 10, 'event_and_date': 'Fall of The Old World V - March 2019', 'complete': "True"}, 'bench_all_of_em': {'id': 'bench_all_of_em', 'category': 'scotland', 'points': 30, 'complete': "False", 'event_and_date': ''}, 'squad_goals': {'id': 'squad_goals', 'category': 'scotland', 'points': 30, 'complete': "False", 'event_and_date': ''}, 'two_heads_are_better_than_one': {'id': 'two_heads_are_better_than_one', 'category': 'scotland', 'points': 30, 'complete': "False", 'event_and_date': ''}, 'theyll_never_take_our_freedom': {'id': 'theyll_never_take_our_freedom', 'category': 'scotland', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'never_meet_your_heroes': {'id': 'never_meet_your_heroes', 'category': 'scotland', 'points': 10, 'event_and_date': 'Tempest 2019 - January 2019', 'complete': "True"}, 'objectives': {'id': 'objectives', 'category': 'kill_points', 'points': 10, 'complete': "False", 'event_and_date': ''}, 'objectives_2': {'id': 'objectives_2', 'category': 'kill_points', 'points': 20, 'complete': "False", 'event_and_date': ''},
				'objectives_3': {'id': 'objectives_3', 'category': 'kill_points', 'points': 50, 'complete': "False", 'event_and_date': ''}, 'objectives_4': {'id': 'objectives_4', 'category': 'kill_points', 'points': 100, 'complete': "False", 'event_and_date': ''}}
							
				for (const [ k, v ] of Object.entries(achievement_data))
				{
					addAchievement(k,v);
				}
			}
			else
			{			
				$.getJSON("data/achievement_data.json", function(json)
				{
					let data = json[playerId];
					achievement_data = json[playerId];
					
					for (const [ k, v ] of Object.entries(achievement_data))
					{
						addAchievement(k,v);
					}
				});
			}

		}
		
		function addAchievement(k, v)
		{
			if (k == "total_score") { return; }
			
			var achievement_table = document.getElementById("achievement_table");
			var achievement_entry ='<tr><td><div class="container"><img src="achievements/%id%_incomplete.png"><div class="centered">%event_and_date%</div></div></td></tr>';
			achievement_entry = achievement_entry.replace("%event_and_date%", v["event_and_date"]);
			achievement_entry = achievement_entry.replace("%id%", k);
			
			if (v["event_and_date"] != "")
			{
				achievement_entry = achievement_entry.replace("_incomplete", "");
			}
			
			var entryNode = document.createElement('tr');
			entryNode.innerHTML = achievement_entry;
			achievement_table.appendChild(entryNode); 
		}
	
		function getQueryVariable(variable) {
			var query = window.location.search.substring(1);
			var vars = query.split('&');
			for (var i = 0; i < vars.length; i++) {
				var pair = vars[i].split('=');
				if (decodeURIComponent(pair[0]) == variable) {
					return decodeURIComponent(pair[1]);
				}
			}
			console.log('Query variable %s not found', variable);
		}
		function ordinal_suffix_of(i) {
			var j = i % 10,
				k = i % 100;
			if (j == 1 && k != 11) {
				return i + "st";
			}
			if (j == 2 && k != 12) {
				return i + "nd";
			}
			if (j == 3 && k != 13) {
				return i + "rd";
			}
			return i + "th";
		}
	
		function getPlayerId()
		{
			let s = getQueryVariable("player_id");
			let no_quotes = s.replace(/['"]+/g, '');
			return no_quotes;
		}
	
	    function addRow(data, noRowToAdd="False")
        {
            let firstRow = document.querySelector('tr[id=eventRow0');
			let row = firstRow;
			
			if (!noRowToAdd)
			{
				let cloneRow = firstRow.cloneNode("True");
				let nextId = parseInt(cloneRow.id.match(/\d+/g), 10 ) + 1;
				cloneRow.id = 'eventRow'+nextId;
				
				row = cloneRow;
			}
			
			let cells = row.getElementsByTagName('td');

			for(var i=0; i < cells.length; i++){
				if (cells[i].getAttribute('type') == 'armyName')
				{
					let faction = data["faction"];
					cells[i].innerHTML = "<a type='nochange' href='faction_page.html?faction_id="+faction+"'>" + faction + "</a>";
				}
				else if (cells[i].getAttribute('type') == 'eventName')
				{
					cells[i].innerHTML = data["event_name"];
				}
				else if (cells[i].getAttribute('type') == 'eventDate')
				{
					cells[i].innerHTML = data["date"];
				}
				if (cells[i].getAttribute('type') == 'placing')
				{
					let placingString = ordinal_suffix_of(data["placing"])
					cells[i].innerHTML = placingString + " out of " + data["num_players"];
				}
				if (cells[i].getAttribute('type') == 'score')
				{
					cells[i].innerHTML = Math.round(data["gaussian_score"], 1).toFixed(1);
				}
				if (cells[i].getAttribute('type') == 'metabreakerScore')
				{
					let mbrsScore = Math.round(data["metabreakers_score"]*100, 1).toFixed(1);
					let posNegString = "<font color='grey'>";
					if (mbrsScore > 0) posNegString = "<font color='green'>+";
				
					cells[i].innerHTML = posNegString+mbrsScore+"</font>";
				}
			}
			
			if (!noRowToAdd)
			{
				firstRow.parentNode.appendChild(row);
			}
        }
	</script>
	
</body>
</html>
